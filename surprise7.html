<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"/>
<title>Kiwi Maze ‚Äî Hard Mobile Edition ü•ùüïä</title>
<style>
  :root{
    --accent:#ff6b9a;
    --bg1:#0b0610;
    --bg2:#2b0632;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg1),var(--bg2));-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-family:"Poppins", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
  .wrap{min-height:100%;display:flex;flex-direction:column;align-items:center;gap:8px;padding:12px;box-sizing:border-box;}
  header{width:100%;max-width:920px;display:flex;align-items:center;justify-content:space-between;gap:12px;color:#ffdce9}
  h1{font-size:18px;margin:0;text-shadow:0 6px 30px rgba(255,107,154,0.08)}
  #game { width:min(92vw,920px); aspect-ratio:1/1; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:16px; box-shadow:0 10px 40px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.02); position:relative; overflow:hidden; touch-action:none; }
  canvas{width:100%;height:100%;display:block;border-radius:12px;}
  .controls { width:min(92vw,920px); max-width:920px; display:flex; justify-content:center; gap:14px; margin-top:6px; }
  .btn { width:64px;height:64px;border-radius:12px;border:none;background:linear-gradient(180deg,rgba(255,255,255,0.03), rgba(255,255,255,0.02)); color:var(--accent); font-weight:700;font-size:22px; display:flex;align-items:center;justify-content:center; box-shadow:0 8px 24px rgba(0,0,0,0.45); touch-action: manipulation;}
  .btn:active{transform:translateY(3px) scale(.995)}
  #hud{width:min(92vw,920px);display:flex;justify-content:space-between;color:#ffd6e8;font-size:13px;align-items:center;gap:10px;margin-top:8px}
  #quote{max-width:920px;color:#ffeef6;text-align:center;font-size:15px;min-height:40px}
  .overlayMsg { position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none; }
  .msgBox { pointer-events:auto; background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02)); padding:18px 22px;border-radius:12px;color:#111; max-width:86%; text-align:center; box-shadow:0 10px 30px rgba(0,0,0,0.6); }
  .msgTitle { font-size:18px;color:var(--accent); margin:0 0 6px;}
  .tiny { font-size:12px; color:#ffd6e8; margin-top:8px;}
  .confetti { position: absolute; width:10px;height:14px;border-radius:2px;transform-origin:center; }
  @media (max-width:420px){ .btn { width:56px;height:56px;font-size:20px } h1{font-size:16px} }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>Kiwi Maze ‚Äî Hard (Mobile) ü•ùüïä</h1>
    <div style="font-size:13px;color:#ffd6e8">Move with buttons or swipe ‚Ä¢ New maze each play</div>
  </header>

  <div id="game">
    <canvas id="c"></canvas>
    <div class="overlayMsg" id="overlay" style="display:none">
      <div class="msgBox" id="msgBox">
        <div class="msgTitle" id="msgTitle">You did it!</div>
        <div id="msgText">ü•ù reached üïä ‚Äî love wins!</div>
        <div class="tiny">Tap anywhere to play again</div>
      </div>
    </div>
  </div>

  <div class="controls" id="controls">
    <button class="btn" id="left">‚óÄ</button>
    <button class="btn" id="up">‚ñ≤</button>
    <button class="btn" id="down">‚ñº</button>
    <button class="btn" id="right">‚ñ∂</button>
  </div>

  <div id="hud">
    <div id="timer">Time: 00:00</div>
    <div id="quote">Tip: Small, careful moves are key. You can also swipe in the maze area.</div>
  </div>
</div>

<script>
/* ===== CONFIG ===== */
const ROWS=25,COLS=25;
const canvas=document.getElementById('c'),ctx=canvas.getContext('2d');
let cellSize, offsetX, offsetY;
const kiwiEmoji='ü•ù',pigeonEmoji='üïäÔ∏è';
const quotes=["ü•ùüíãüïä Kiwi kisses Pigeon üíñ","üç¨‚ù§Ô∏è Love Candy Surprise ‚ú®","üéÜ Fireworks of Forever Love üéá","‚òÄÔ∏è You're my sunshine, always üíõ"];
/* ===== STATE ===== */
let maze, kiwi={x:1,y:1},pigeon={x:COLS-2,y:ROWS-2},hearts=[],confettiParts=[],running=false,startTime=0,timerInterval=null,won=false;

/* ===== UTIL ===== */
function inBounds(x,y){return x>=0&&y>=0&&x<COLS&&y<ROWS;}
function makeEmptyMaze(rows,cols){return Array.from({length:rows},()=>Array(cols).fill(1));}
function generateMazeDFS(){
  maze=makeEmptyMaze(ROWS,COLS);
  function carve(sx,sy){
    maze[sy][sx]=0;
    const dirs=[[0,-2],[2,0],[0,2],[-2,0]];
    for(let i=dirs.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [dirs[i],dirs[j]]=[dirs[j],dirs[i]]; }
    for(const [dx,dy] of dirs){
      const nx=sx+dx, ny=sy+dy;
      if(inBounds(nx,ny)&&maze[ny][nx]===1){ maze[sy+dy/2][sx+dx/2]=0; carve(nx,ny); }
    }
  }
  carve(1,1); maze[1][1]=0; maze[ROWS-2][COLS-2]=0;
  // pick farthest open cells for kiwi & pigeon
  const opens=[]; for(let y=0;y<ROWS;y++) for(let x=0;x<COLS;x++) if(maze[y][x]===0) opens.push({x,y});
  const A=opens[Math.floor(Math.random()*opens.length)]; let B=A,best=-1; for(const p of opens){const d=Math.abs(p.x-A.x)+Math.abs(p.y-A.y);if(d>best){best=d;B=p;}}
  let C=B; best=-1; for(const p of opens){const d=Math.abs(p.x-B.x)+Math.abs(p.y-B.y);if(d>best){best=d;C=p;}}
  kiwi={x:B.x,y:B.y}; pigeon={x:C.x,y:C.y};
}

/* ===== DRAW ===== */
function resizeCanvas(){
  const rect=document.getElementById('game').getBoundingClientRect();
  canvas.width=Math.floor(rect.width*devicePixelRatio);
  canvas.height=Math.floor(rect.height*devicePixelRatio);
  ctx.setTransform(1,0,0,1,0,0);
  ctx.scale(devicePixelRatio,devicePixelRatio);
  cellSize=Math.floor(Math.min(rect.width/COLS,rect.height/ROWS));
  offsetX=Math.floor((rect.width-cellSize*COLS)/2);
  offsetY=Math.floor((rect.height-cellSize*ROWS)/2);
}
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const now=performance.now();
  // draw maze
  for(let y=0;y<ROWS;y++){
    for(let x=0;x<COLS;x++){
      const px=offsetX+x*cellSize, py=offsetY+y*cellSize;
      ctx.fillStyle=maze[y][x]===1?"#2b1b2b":"rgba(255,255,255,0.01)";
      ctx.fillRect(px,py,cellSize,cellSize);
    }
  }
  // draw hearts
  for(let i=hearts.length-1;i>=0;i--){
    const h=hearts[i],age=now-h.t;
    if(age>800){hearts.splice(i,1);continue;}
    ctx.globalAlpha=1-age/800;
    ctx.font=`${Math.floor(cellSize*0.42)}px serif`; ctx.textAlign='center';
    ctx.fillText('üíñ',offsetX+h.x*cellSize+cellSize/2,offsetY+h.y*cellSize+cellSize/2+cellSize*0.12);
    ctx.globalAlpha=1;
  }
  // draw goal
  ctx.font=`${Math.floor(cellSize*1.2)}px serif`; ctx.textAlign='center';
  ctx.fillText(pigeonEmoji,offsetX+pigeon.x*cellSize+cellSize/2,offsetY+pigeon.y*cellSize+cellSize/2+cellSize*0.12);
  // draw kiwi
  ctx.fillText(kiwiEmoji,offsetX+kiwi.x*cellSize+cellSize/2,offsetY+kiwi.y*cellSize+cellSize/2+cellSize*0.12);
  requestAnimationFrame(draw);
}

/* ===== MOVEMENT ===== */
function showHeartAt(x,y){hearts.push({x,y,t:performance.now()}); if(hearts.length>40) hearts.shift();}
function tryMove(dx,dy){if(won) return; const nx=kiwi.x+dx,ny=kiwi.y+dy;if(!inBounds(nx,ny)||maze[ny][nx]===1)return; kiwi={x:nx,y:ny}; showHeartAt(nx,ny); checkWin(); if(!running) startTimer();}
function checkWin(){if(kiwi.x===pigeon.x&&kiwi.y===pigeon.y&&!won){won=true; stopTimer(); showWin(quotes[Math.floor(Math.random()*quotes.length)]);}}
function showWin(text){document.getElementById('overlay').style.display='flex'; document.getElementById('msgText').textContent=text; document.getElementById('quote').textContent=text; document.getElementById('overlay').onclick=()=>{document.getElementById('overlay').style.display='none'; restart();};}

/* ===== TIMER ===== */
function formatTime(ms){const s=Math.floor(ms/1000); return `${String(Math.floor(s/60)).padStart(2,'0')}:${String(s%60).padStart(2,'0')}`;}
function startTimer(){if(running)return;running=true;startTime=performance.now();timerInterval=setInterval(()=>{document.getElementById('timer').textContent='Time:'+formatTime(performance.now()-startTime);},500);}
function stopTimer(){running=false;clearInterval(timerInterval); timerInterval=null;}

/* ===== INPUT ===== */
document.getElementById('left').addEventListener('click',()=>tryMove(-1,0));
document.getElementById('up').addEventListener('click',()=>tryMove(0,-1));
document.getElementById('down').addEventListener('click',()=>tryMove(0,1));
document.getElementById('right').addEventListener('click',()=>tryMove(1,0));
let sx=0,sy=0;
canvas.addEventListener('touchstart',e=>{const t=e.touches[0];sx=t.clientX;sy=t.clientY;if(!running) startTimer();},{passive:true});
canvas.addEventListener('touchend',e=>{const t=e.changedTouches[0],dx=t.clientX-sx,dy=t.clientY-sy;const absX=Math.abs(dx),absY=Math.abs(dy);if(Math.max(absX,absY)<20)return;if(absX>absY) dx>0?tryMove(1,0):tryMove(-1,0); else dy>0?tryMove(0,1):tryMove(0,-1);},{passive:true});
window.addEventListener('keydown',e=>{if(e.key==='ArrowLeft')tryMove(-1,0); if(e.key==='ArrowUp')tryMove(0,-1); if(e.key==='ArrowRight')tryMove(1,0); if(e.key==='ArrowDown')tryMove(0,1);});

/* ===== RESTART ===== */
function restart(){won=false; running=false; hearts=[]; generateMazeDFS(); document.getElementById('timer').textContent='Time:00:00'; document.getElementById('quote').textContent="Tip: Small, careful moves are key."; resizeCanvas(); draw();}

/* ===== INIT ===== */
generateMazeDFS(); resizeCanvas(); draw();
window.addEventListener('resize',resizeCanvas);
window.addEventListener('orientationchange',()=>setTimeout(resizeCanvas,200));
</script>
</body>
</html>
